"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[874,4759,2591],{75183:(e,t,n)=>{var a;n.d(t,{A:()=>i}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated",e.History="History",e.MetadataReferenceModified="MetadataReferenceModified",e.LabelChange="LabelChange"}(a||(a={}));const i=a},94021:(e,t,n)=>{var a;n.d(t,{A:()=>i}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",e.VOLUMECROPPINGCONTROL_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPINGCONTROL_TOOL_CHANGED",e.VOLUMECROPPING_TOOL_CHANGED="CORNERSTONE_TOOLS_VOLUMECROPPING_TOOL_CHANGED",e.STACK_PREFETCH_COMPLETE="CORNERSTONE_TOOLS_STACK_PREFETCH_COMPLETE",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",e.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(a||(a={}));const i=a},18682:(e,t,n)=>{var a;n.d(t,{A:()=>i}),function(e){e.Labelmap="Labelmap",e.Contour="Contour",e.Surface="Surface"}(a||(a={}));const i=a},84093:(e,t,n)=>{var a;n.d(t,{A:()=>i}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.Interpolate="interpolate",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.AddPreview="addPreview",e.ComputeInnerCircleRadius="computeInnerCircleRadius",e.GetStatistics="getStatistics",e.EnsureImageVolumeFor3DManipulation="ensureImageVolumeFor3DManipulation",e.EnsureSegmentationVolumeFor3DManipulation="ensureSegmentationVolumeFor3DManipulation"}(a||(a={}));const i=a},66452:(e,t,n)=>{var a,i;n.d(t,{i:()=>a,q:()=>i}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button",e[e.Wheel=524288]="Wheel",e[e.Wheel_Primary=524289]="Wheel_Primary"}(a||(a={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(i||(i={}))},49892:(e,t,n)=>{var a;n.d(t,{A:()=>i}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(a||(a={}));const i=a},10401:(e,t,n)=>{var a;n.d(t,{H:()=>a}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(a||(a={}))},99737:(e,t,n)=>{n.r(t),n.d(t,{AnnotationStyleStates:()=>s,ChangeTypes:()=>p.A,Events:()=>l.A,KeyboardBindings:()=>i.q,MouseBindings:()=>i.i,SegmentationRepresentations:()=>c.A,StrategyCallbacks:()=>u.A,Swipe:()=>m.H,ToolModes:()=>o.A,WorkerTypes:()=>d});var a,i=n(66452),o=n(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(a||(a={}));const s=a;var r,l=n(94021),c=n(18682),m=n(10401),u=n(84093),p=n(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces",e.COMPUTE_STATISTICS="Computing Statistics",e.INTERPOLATE_LABELMAP="Interpolating Labelmap",e.COMPUTE_LARGEST_BIDIRECTIONAL="Computing Largest Bidirectional",e.GENERATE_CONTOUR_SETS="Generating Contour Sets"}(r||(r={}));const d=r},14696:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});var a={};n.r(a),n.d(a,{updateSegmentationsChartDisplaySet:()=>S});const i=JSON.parse('{"UU":"@ohif/extension-cornerstone-dynamic-volume"}').UU;var o=n(4667),s=n(15327),r=n(42356);const l="CHT",c=r.Wp.guid(),m="1.9.451.13215.7.3.2.7.6.1",{utilities:u}=o;function p(e,t){const n=e.imageIds.reduce((e,n)=>{const a=r.H8.getInstanceByImageId(n)[t];return void 0!==a&&e.add(a),e},new Set);return Array.from(n).sort((e,t)=>e-t)}function d(e,t,{servicesManager:n}){const{displaySetService:a,segmentationService:i,viewportGridService:o}=n.services;let l;const c=a.getActiveDisplaySets().find(e=>{const t=e.instances?.[0];return!!t&&(void 0!==t.FrameReferenceTime||void 0!==t.NumberOfTimeSlices)}).displaySetInstanceUID;for(const[e]of s.cache._volumeCache)if(e.includes(c)){l=e;break}let m;l&&(m=s.cache.getVolume(l));const{StudyInstanceUID:d,StudyDescription:O}=r.H8.getInstanceByImageId(m.imageIds[0]),S=i.getLabelmapVolume(e.segmentationId),E=S?.volumeId,[T,y]=u.dynamicVolume.getDataInTime(m,{maskVolumeId:E}),N=T.length;if(0===N)return[];const g=o.getActiveViewportId(),I=i.getSegmentColor(g,e.segmentationId,1),D=s.utilities.color.rgbToHex(I[0],I[1],I[2]);let _=t.get(m);_||(_=function(e){const t={FrameReferenceTime:{unit:"ms"}},n=Object.keys(t);let a,i;for(let o=0;o<n.length;o++){const s=n[o],r=p(e,s);if(r.length){a=r,i=t[s].unit;break}}if(!a.length){const e=n.join(", ");throw new Error(`Could not extract time points data for the following tags: ${e}`)}const o=function(e,t){const n=["ms","s","m","h"],a=[1e3,60,60],i=n.indexOf(t);let o=1;if(-1!==i){for(let s=i;s<n.length-1;s++){const i=o*a[s];if(e.filter(e=>e>i).length<=e.length/2)break;o=i,t=n[s+1]}o>1&&(e=e.map(e=>e/o))}return{timePoints:e,timePointsUnit:t}}(a,i);return a=o.timePoints,i=o.timePointsUnit,{timePoints:a,timePointsUnit:i}}(m),t.set(m,_));const{timePoints:C,timePointsUnit:v}=_;if(C.length!==T[0].length)throw new Error("Invalid number of time points returned");const R=C.length,f=new Array(R);for(let e=0;e<R;e++){const t=T.reduce((t,n)=>t+n[e]/N,0);f[e]=[C[e],t]}return{StudyInstanceUID:d,StudyDescription:O,chartData:{series:{label:e.label,points:f,color:D},axis:{x:{label:`Time (${v})`},y:{label:"Vl (Bq/ml)"}}}}}function O(e,{servicesManager:t}){if(!e.length)return;const n=new WeakMap,a=e.map(e=>d(e,n,{servicesManager:t})),{date:i,time:o}=function(){const e=new Date;return{date:e.getFullYear()+("0"+e.getUTCMonth()).slice(-2)+("0"+e.getUTCDate()).slice(-2),time:("0"+e.getUTCHours()).slice(-2)+("0"+e.getUTCMinutes()).slice(-2)+("0"+e.getUTCSeconds()).slice(-2)}}(),s=a.reduce((e,t)=>[...e,t.chartData.series],[]),u={SOPClassUID:m,Modality:l,SOPInstanceUID:r.Wp.guid(),SeriesDate:i,SeriesTime:o,SeriesInstanceUID:c,StudyInstanceUID:a[0].StudyInstanceUID,StudyDescription:a[0].StudyDescription,SeriesNumber:100,SeriesDescription:"Segmentation chart series data",chartData:{series:s,axis:{...a[0].chartData.axis}}};return{seriesMetadata:{StudyInstanceUID:u.StudyInstanceUID,StudyDescription:u.StudyDescription,SeriesInstanceUID:u.SeriesInstanceUID,SeriesDescription:u.SeriesDescription,SeriesNumber:u.SeriesNumber,SeriesTime:u.SeriesTime,SOPClassUID:u.SOPClassUID,Modality:u.Modality},instance:u}}function S({servicesManager:e}){const{segmentationService:t}=e.services,n=t.getSegmentations(),{seriesMetadata:a,instance:i}=O(n,{servicesManager:e})??{};a&&i&&(r.H8.addSeriesMetadata([a],!0),r.H8.addInstances([i],!0))}const{downloadCsv:E}=r.Wp,T=({commandsManager:e,servicesManager:t})=>{const n=t.services,{displaySetService:i,viewportGridService:r,segmentationService:l}=n,c={...a,getDynamic4DDisplaySet:()=>i.getActiveDisplaySets().find(e=>{const t=e.instances?.[0];return!!t&&(void 0!==t.FrameReferenceTime||void 0!==t.NumberOfTimeSlices||void 0!==t.TemporalPositionIdentifier)}),getComputedDisplaySets:()=>[...i.getDisplaySetCache().values()].filter(e=>e.isDerived),exportTimeReportCSV:({segmentations:e,summaryStats:t})=>{const n=c.getDynamic4DDisplaySet(),a=n?.displaySetInstanceUID;let i,r;for(const[e]of s.cache._volumeCache)if(e.includes(a)){i=e;break}i&&(r=s.cache.getVolume(i));const m=n.instances[0],u=[];function p(e){const t=e.length,n=e.reduce((e,t)=>e+t,0)/t,a=e.map(e=>(e-n)**2).reduce((e,t)=>e+t,0)/t;return Math.sqrt(a)}u.push(`Patient ID,${m.PatientID},`),u.push(`Study Date,${m.StudyDate},`),u.push(`StudyInstanceUID,${m.StudyInstanceUID},`),u.push(`StudyDescription,${m.StudyDescription},`),u.push(`SeriesInstanceUID,${m.SeriesInstanceUID},`),u.push(""),u.push(""),e.forEach(e=>{const n=l.getLabelmapVolume(e.segmentationId),[a,i]=o.utilities.dynamicVolume.getDataInTime(r,{maskVolumeId:n.volumeId});if(t){let t="Operation,Segmentation Label ID";const n=r.numTimePoints;for(let e=0;e<n;e++)t+=`,Time Point ${e}`;u.push(t);const o=[],s=[],l=[],c=[],m=[],d=[],O=a.length;for(let e=0;e<n;e++){const t=[];let n=0,r=1/0,u=-1/0,S=0,E=0;for(let i=0;i<O;i++){const o=a[i][e];t.push(o),n+=o,o<r&&(r=o,S=i),o>u&&(u=o,E=i)}o.push(n/O),s.push(r),l.push(i[S]),c.push(u),m.push(i[E]),d.push(p(t))}let S=`Mean,${e.label}`;for(let e=0;e<n;e++)S+=`,${o[e]}`;u.push(S),S=`Standard Deviation,${e.label}`;for(let e=0;e<n;e++)S+=`,${d[e]}`;u.push(S),S=`Min,${e.label}`;for(let e=0;e<n;e++)S+=`,${s[e]}`;u.push(S),S=`Max,${e.label}`;for(let e=0;e<n;e++)S+=`,${c[e]}`;u.push(S)}else{let t="Pixel Identifier (IJK),Segmentation Label ID";const n=r.numTimePoints;for(let e=0;e<n;e++)t+=`,Time Point ${e}`;u.push(t);for(let t=0;t<a.length;t++){let n=`${`${i[t][0]}_${i[t][1]}_${i[t][2]}`},${e.label}`;for(let e=0;e<a[t].length;e++)n+=`,${a[t][e]}`;u.push(n)}}});const d=u.join("\n"),O=`${m.PatientID}.csv`;E(d,{filename:O})},swapDynamicWithComputedDisplaySet:({displaySet:t})=>{const n=t,a=i.getDisplaySetCache(),o=[a.keys()],{displaySetInstanceUID:s}=n;o.includes(s)||a.set(s,n);const{viewports:l}=r.getState(),m=c.getDynamic4DDisplaySet(),u=[];for(const[e,t]of l){const e=t,n=e.viewportOptions,{displaySetInstanceUIDs:a}=e,i=a.indexOf(m.displaySetInstanceUID);if(-1!==i){const t={viewportId:e.viewportId,displaySetInstanceUIDs:[...a.slice(0,i),s,...a.slice(i+1)],viewportOptions:{initialImageOptions:n.initialImageOptions,viewportType:"volume",orientation:n.orientation,background:n.background}};u.push(t)}}e.run("setDisplaySetsForViewports",{viewportsToUpdate:u})},swapComputedWithDynamicDisplaySet:()=>{const t=c.getDynamic4DDisplaySet(),n=i.getDisplaySetCache(),a=[...n.keys()],{displaySetInstanceUID:o}=t;a.includes(o)||n.set(o,t);const{viewports:s}=r.getState(),l=c.getComputedDisplaySets()[0],m=[];for(const[e,t]of s){const e=t,n=e.viewportOptions,{displaySetInstanceUIDs:a}=e,i=a.indexOf(l.displaySetInstanceUID);if(-1!==i){const t={viewportId:e.viewportId,displaySetInstanceUIDs:[...a.slice(0,i),o,...a.slice(i+1)],viewportOptions:{initialImageOptions:n.initialImageOptions,viewportType:"volume",orientation:n.orientation,background:n.background}};m.push(t)}}e.run("setDisplaySetsForViewports",{viewportsToUpdate:m})},createNewLabelMapForDynamicVolume:async({label:e})=>{const{viewports:t,activeViewportId:n}=r.getState(),a=c.getDynamic4DDisplaySet(),o=a.displaySetInstanceUID;let s;if(t.get(n).displaySetInstanceUIDs.includes(o)&&(s=a),!s){const e=i.getDisplaySetCache();for(const[t,n]of e)if(n.referenceDisplaySetUID===o){s=n;break}}if(!s)throw new Error("No reference display set found based on the dynamic data");const m=i.getDisplaySetByUID(s.displaySetInstanceUID),u=await l.createLabelmapForDisplaySet(m,{label:e}),p=t.values().next().value;return await l.addSegmentationRepresentation(p.viewportId,{segmentationId:u}),u}},m={updateSegmentationsChartDisplaySet:{commandFn:c.updateSegmentationsChartDisplaySet,storeContexts:[],options:{}},exportTimeReportCSV:{commandFn:c.exportTimeReportCSV,storeContexts:[],options:{}},swapDynamicWithComputedDisplaySet:{commandFn:c.swapDynamicWithComputedDisplaySet,storeContexts:[],options:{}},createNewLabelMapForDynamicVolume:{commandFn:c.createNewLabelMapForDynamicVolume,storeContexts:[],options:{}},swapComputedWithDynamicDisplaySet:{commandFn:c.swapComputedWithDynamicDisplaySet,storeContexts:[],options:{}}};return{actions:c,definitions:m,defaultContext:"DYNAMIC-VOLUME:CORNERSTONE"}};var y=n(86326),N=n(1246);const g=e=>null==e?"":String(e).toUpperCase(),I=({title:e,tooltip:t})=>y.createElement("div",{className:"flex items-center space-x-1"},y.createElement(N.m_M,null,y.createElement(N.k$k,{asChild:!0},y.createElement("span",null,y.createElement(N.FI1.ByName,{name:"info-link",className:"text-primary h-3 w-3"}))),y.createElement(N.ZIw,{sideOffset:4,className:"max-w-xs"},y.createElement("div",null,t))),y.createElement("span",{className:"text-muted-foreground text-xs uppercase tracking-wide"},e)),D=({isPlaying:e,onPlayPauseChange:t,fps:n,onFpsChange:a,minFps:i,maxFps:o,currentDimensionGroupNumber:r,onDimensionGroupChange:l,numDimensionGroups:c,onGenerate:m,onDoubleRangeChange:u,rangeValues:p,onDynamicClick:d})=>{const[O,S]=(0,y.useState)(!1),[E,T]=(0,y.useState)(s.Enums.DynamicOperatorType.SUM);return y.createElement("div",{className:"flex select-none flex-col"},y.createElement(N.aUM,{defaultOpen:!0},y.createElement(N.aUM.Header,null,"Controls"),y.createElement(N.aUM.Content,{className:"bg-muted space-y-4 px-5 pt-2 pb-4"},y.createElement("div",{className:"mb-4"},y.createElement(I,{title:"View",tooltip:"Select the view mode, 4D to view the dynamic volume or Computed to view the computed volume"}),y.createElement(N.tUM,{value:O?"computed":"4d",onValueChange:e=>{const t="computed"===e;S(t),t||"function"!=typeof d||d()},className:"my-2 w-full"},y.createElement(N.j7C,{className:"w-full"},y.createElement(N.Xib,{value:"4d",className:"w-1/2"},"4D"),y.createElement(N.Xib,{value:"computed",className:"w-1/2"},"Computed")))),y.createElement("div",null,y.createElement(_,{onPlayPauseChange:t,isPlaying:e,computedView:O,fps:n,onFpsChange:a,minFps:i,maxFps:o,numDimensionGroups:c,onDimensionGroupChange:l,currentDimensionGroupNumber:r})),y.createElement("div",{className:"mt-3 flex flex-col "+(O?"":"ohif-disabled")},y.createElement(I,{title:"Computed Operation",tooltip:y.createElement("div",null,"Operation Buttons (SUM, AVERAGE, SUBTRACT): Select the mathematical operation to be applied to the data set.",y.createElement("br",null)," Range Slider: Choose the numeric range of dimension groups within which the operation will be performed.",y.createElement("br",null),"Generate Button: Execute the chosen operation on the specified range of data.")}),y.createElement(N.tUM,{value:String(E),onValueChange:e=>{T(e)},className:"mt-2 w-full"},y.createElement(N.j7C,{className:"w-full gap-1"}," ",y.createElement(N.Xib,{value:String(s.Enums.DynamicOperatorType.SUM),className:"w-1/3"},g(s.Enums.DynamicOperatorType.SUM)),y.createElement(N.Xib,{value:String(s.Enums.DynamicOperatorType.AVERAGE),className:"w-1/3"},g(s.Enums.DynamicOperatorType.AVERAGE)),y.createElement(N.Xib,{value:String(s.Enums.DynamicOperatorType.SUBTRACT),className:"w-1/3"},g(s.Enums.DynamicOperatorType.SUBTRACT)))),y.createElement("div",{className:"mt-2 w-full"},y.createElement(N.ewR.Container,{mode:"doubleRange",min:1,max:c||1,values:p||[1,c||1],onChange:u||(()=>{})},y.createElement(N.ewR.DoubleRange,{showNumberInputs:!0}))),y.createElement(N.$nd,{variant:"default",size:"sm",className:"mt-2 h-[26px] w-[115px] self-start p-0",onClick:()=>{try{"function"==typeof m?m(E):console.error("onGenerate is not a function",m)}catch(e){console.error("Error in onGenerate:",e)}}},"Generate")))))};function _({isPlaying:e,onPlayPauseChange:t,fps:n,minFps:a,maxFps:i,onFpsChange:o,numDimensionGroups:s,onDimensionGroupChange:r,currentDimensionGroupNumber:l,computedView:c}){return y.createElement("div",{className:c?"ohif-disabled":""},y.createElement(I,{title:"4D Controls",tooltip:y.createElement("div",null,"Play/Pause Button: Begin or pause the animation of the 4D visualization. ",y.createElement("br",null),"Dimension Group Selector: Navigate through individual dimension groups of the 4D data."," ",y.createElement("br",null),"FPS (Frames Per Second) Selector: Adjust the playback speed of the animation.")}),y.createElement("div",{className:"mt-3 flex justify-between"},y.createElement(N.$nd,{id:"play-pause-button",variant:"secondary",size:"default",className:"w-[58px]",onClick:()=>{"function"==typeof t&&t(!e)}},y.createElement(N.FI1.ByName,{name:e?"icon-pause":"icon-play",className:"text-foreground h-[24px] w-[24px]"})),y.createElement(N.ewR.Container,{mode:"stepper",value:l||1,onChange:r||(()=>{}),min:1,max:s||1,step:1},y.createElement("div",{className:"flex flex-col items-center"},y.createElement(N.ewR.NumberStepper,{className:"h-[28px] w-[58px]",direction:"horizontal"}),y.createElement(N.ewR.Label,{className:"text-muted-foreground mt-1 text-sm"},"Frame"))),y.createElement(N.ewR.Container,{mode:"stepper",value:n||1,onChange:o||(()=>{}),min:a||1,max:i||30,step:1},y.createElement("div",{className:"flex flex-col items-center"},y.createElement(N.ewR.NumberStepper,{className:"h-[28px] w-[58px]",direction:"horizontal"}),y.createElement(N.ewR.Label,{className:"text-muted-foreground mt-1 text-sm"},"FPS")))))}function C({servicesManager:e,commandsManager:t}){const{cornerstoneViewportService:n,viewportGridService:a,displaySetService:i}=e.services,[{isCineEnabled:r},l]=(0,N.tqw)(),[{activeViewportId:c}]=(0,N.ihW)(),[m,u]=(0,y.useState)([1,1]),[p,d]=(0,y.useState)(null),[O,S]=(0,y.useState)(null),[E,T]=(0,y.useState)(20),[g,I]=(0,y.useState)(r),[_,C]=(0,y.useState)(null),[v,R]=(0,y.useState)(!1),f=(0,y.useRef)(s.utilities.uuidv4()),A=(0,y.useRef)(null),h=`cornerstoneStreamingImageVolume:${f.current}`;function M(e){t.runCommand("swapDynamicWithComputedDisplaySet",{displaySet:e}),R(!0)}(0,y.useEffect)(()=>{const t=n.EVENTS.VIEWPORT_DATA_CHANGED,a=e.services.cineService.EVENTS.CINE_STATE_CHANGED,{unsubscribe:i}=n.subscribe(t,e=>{e.viewportData.data.forEach(e=>{if(e.volume?.isDynamicVolume()){S(e.volume),A.current=e.displaySetInstanceUID;const t=[1,e.volume.numDimensionGroups];u(t)}})}),{unsubscribe:o}=e.services.cineService.subscribe(a,e=>{I(e.isPlaying)});return()=>{i(),o()}},[n,l,e.services.cineService]),(0,y.useEffect)(()=>{const e=s.Enums.Events.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED,t=e=>{C(e.detail.dimensionGroupNumber)};return s.eventTarget.addEventListener(e,t),()=>{s.eventTarget.removeEventListener(e,t)}},[]),(0,y.useEffect)(()=>{const e=a.getDisplaySetsUIDsForViewport(c);if(!e?.length)return;const t=e.map(i.getDisplaySetByUID).find(e=>e.isDynamicVolume);if(!t)return;const n=s.cache.getVolumes().find(e=>e.volumeId.includes(t.displaySetInstanceUID));n&&(S(n),A.current=t.displaySetInstanceUID,u([1,n.numDimensionGroups]))},[c,a,i,n,l]);const w=()=>{I(!0);const e=n.getViewportInfo(c);if(!e)return;const{element:t}=e;l.playClip(t,{framesPerSecond:E,viewportId:c})},L=()=>{I(!1);const{element:e}=n.getViewportInfo(c);l.stopClip(e)};return y.createElement(D,{fps:E,isPlaying:g,onPlayPauseChange:e=>{e?w():L()},minFps:1,maxFps:50,onFpsChange:e=>{T(e),L(),w()},currentDimensionGroupNumber:_,numDimensionGroups:O?.numDimensionGroups||1,onDimensionGroupChange:e=>{O.dimensionGroupNumber=e},onGenerate:async function(e){const a=O.volumeId;if(!a)return;let i=s.cache.getVolume(h);i||(i=await s.volumeLoader.createAndCacheDerivedVolume(a,{volumeId:h}));const[r,l]=m,c=Array.from({length:l-r+1},(e,t)=>r+t),u={dimensionGroupNumbers:"SUBTRACT"===e?[r,l]:c,targetVolume:i};if(o.utilities.dynamicVolume.updateVolumeFromTimeData(O,e,u),p)t.runCommand("updateVolumeData",{volume:i}),n.getRenderingEngine().render(),M(p);else{const e={volumeLoaderSchema:i.volumeId.split(":")[0],displaySetInstanceUID:f.current,SOPClassHandlerId:"@ohif/extension-default.sopClassHandlerModule.stack",Modality:O.metadata.Modality,isMultiFrame:!1,numImageFrames:1,uid:f.current,referenceDisplaySetUID:O.volumeId.split(":")[1],madeInClient:!0,FrameOfReferenceUID:O.metadata.FrameOfReferenceUID,isDerived:!0,imageIds:i.imageIds};d(e),M(e)}},onDynamicClick:v?()=>{t.runCommand("swapComputedWithDynamicDisplaySet")}:null,onDoubleRangeChange:u,rangeValues:m})}const v=function({servicesManager:e,commandsManager:t,tab:n}){return y.createElement(y.Fragment,null,y.createElement("div",{className:"flex flex-col text-white","data-cy":"dynamic-volume-panel"},y.createElement(C,{commandsManager:t,servicesManager:e})))};var R=n(39195),f=n(71903);const A=function({commandsManager:e,servicesManager:t}){const n=(0,f.useSegmentations)({servicesManager:t});return n?.length?y.createElement("div",{className:"flex gap-2"},y.createElement("div",{className:"flex h-8 w-full items-center rounded pr-0.5"},y.createElement(N.$nd,{size:"sm",variant:"ghost",className:"pl-1.5",onClick:()=>{e.runCommand("exportTimeReportCSV",{segmentations:n,options:{filename:"TimeData.csv"}})}},y.createElement(N.FI1.Export,null),y.createElement("span",{className:"pl-1"},"Time Data"))),y.createElement("div",{className:"flex h-8 w-full items-center rounded pr-0.5"},y.createElement(N.$nd,{size:"sm",variant:"ghost",className:"pl-1.5",onClick:()=>{e.runCommand("exportTimeReportCSV",{segmentations:n,summaryStats:!0,options:{filename:"ROIStats.csv"}})}},y.createElement(N.FI1.Export,null),y.createElement("span",{className:"pl-1"},"ROI Stats")))):null};const h=function({commandsManager:e,extensionManager:t,servicesManager:n,configuration:a}){const{toolbarService:i}=n.services;return[{name:"dynamic-volume",iconName:"tab-4d",iconLabel:"4D Workflow",label:"4D Workflow",component:()=>y.createElement(v,{commandsManager:e,servicesManager:n,extensionManager:t})},{name:"dynamic-segmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:()=>y.createElement(y.Fragment,null,y.createElement(R.Toolbox,{buttonSectionId:i.sections.dynamicToolbox,title:"Threshold Tools"}),y.createElement(f.PanelSegmentation,{servicesManager:n,commandsManager:e,extensionManager:t,configuration:a},y.createElement(A,{servicesManager:n,commandsManager:e})))}]},M="2hot",w="dynamic4D-pt",L="dynamic4D-fusion",P="dynamic4D-ct";function U({colormap:e,voiInverted:t}={}){return{blendMode:"MIP",colormap:e,voi:{windowWidth:5,windowCenter:2.5},voiInverted:t}}function b(){const e={colormap:{name:M,opacity:[{value:0,opacity:0},{value:.1,opacity:1},{value:1,opacity:1}]},voiInverted:!1};return[{viewportOptions:{viewportId:"ptAxial",viewportType:"volume",orientation:"axial",toolGroupId:w,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...U(e)}}]},{viewportOptions:{viewportId:"ptSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:w,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...U(e)}}]},{viewportOptions:{viewportId:"ptCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:w,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...U(e)}}]}]}function G(){const e={colormap:{name:M,opacity:[{value:0,opacity:0},{value:.1,opacity:.8},{value:1,opacity:.8}]}};return[{viewportOptions:{viewportId:"fusionAxial",viewportType:"volume",orientation:"axial",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...U(e)},id:"ptDisplaySet"}]},{viewportOptions:{viewportId:"fusionSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...U(e)},id:"ptDisplaySet"}]},{viewportOptions:{viewportId:"fusionCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...U(e)},id:"ptDisplaySet"}]}]}const x={id:"default4D",locked:!0,hasUpdatedPriorsInformation:!1,name:"Default",createdDate:"2023-01-01T00:00:00.000Z",modifiedDate:"2023-01-01T00:00:00.000Z",availableTo:{},editableBy:{},imageLoadStrategy:"default",protocolMatchingRules:[{attribute:"ModalitiesInStudy",constraint:{contains:["CT","PT"]}}],numberOfPriorsReferenced:-1,displaySetSelectors:{defaultDisplaySetId:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:0}}}]},ctDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]},ptDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"PT"},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"SeriesDescription",constraint:{contains:"Corrected"}},{weight:2,attribute:"SeriesDescription",constraint:{doesNotContain:{value:"Uncorrected"}}}]},chartDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:{value:"CHT"}},required:!0}]}},stages:[{id:"dataPreparation",name:"Data Preparation",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[...b()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"registration",name:"Registration",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:3}},viewports:[...G(),{viewportOptions:{viewportId:"ctAxial",viewportType:"volume",orientation:"axial",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},{viewportOptions:{viewportId:"ctSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},{viewportOptions:{viewportId:"ctCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},...b()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"roiQuantification",name:"ROI Quantification",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[...G()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"kineticAnalysis",name:"Kinetic Analysis",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:1/3,height:.5},{x:1/3,y:0,width:1/3,height:.5},{x:2/3,y:0,width:1/3,height:.5},{x:0,y:.5,width:1,height:.5}]}},viewports:[...G(),{viewportOptions:{viewportId:"seriesChart"},displaySets:[{id:"chartDisplaySet",options:{skipLoading:!0}}]}],createdDate:"2023-01-01T00:00:00.000Z"}]};const V={id:i,preRegistration:({servicesManager:e,commandsManager:t,configuration:n={}})=>{s.cache.setMaxCacheSize(5368709120)},getPanelModule:h,getHangingProtocolModule:function(){return[{name:x.id,protocol:x}]},getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:n})=>T({servicesManager:e,commandsManager:t,extensionManager:n})}}}]);
//# sourceMappingURL=874.bundle.0889ebef620745d5c59a.js.map