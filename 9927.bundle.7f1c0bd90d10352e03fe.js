"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9927],{69927:(e,o,t)=>{t.r(o),t.d(o,{default:()=>w});var a=t(42356);const n=.5,i=99.5,s="ctToolGroup",l="ptToolGroup",r="fusionToolGroup",u="mipToolGroup",d="default";const c=function(e,o,t,a){!function(e,o,t,a){const c={active:[{toolName:e.WindowLevel,bindings:[{mouseButton:o.MouseBindings.Primary}]},{toolName:e.Pan,bindings:[{mouseButton:o.MouseBindings.Auxiliary}]},{toolName:e.Zoom,bindings:[{mouseButton:o.MouseBindings.Secondary},{numTouchPoints:2}]},{toolName:e.StackScroll,bindings:[{mouseButton:o.MouseBindings.Wheel},{numTouchPoints:3}]}],passive:[{toolName:e.Length},{toolName:e.SegmentBidirectional},{toolName:e.ArrowAnnotate,configuration:{getTextCallback:(e,o)=>{a.runCommand("arrowTextCallback",{callback:e,eventDetails:o})},changeTextCallback:(e,o,t)=>{a.runCommand("arrowTextCallback",{callback:t,data:e,eventDetails:o})}}},{toolName:e.Bidirectional},{toolName:e.DragProbe},{toolName:e.Probe},{toolName:e.EllipticalROI},{toolName:e.RectangleROI},{toolName:e.StackScroll},{toolName:e.Angle},{toolName:e.CobbAngle},{toolName:e.Magnify},{toolName:"CircularBrush",parentTool:"Brush",configuration:{activeStrategy:"FILL_INSIDE_CIRCLE",minRadius:n,maxRadius:i}},{toolName:"CircularEraser",parentTool:"Brush",configuration:{activeStrategy:"ERASE_INSIDE_CIRCLE",minRadius:n,maxRadius:i}},{toolName:"SphereBrush",parentTool:"Brush",configuration:{activeStrategy:"FILL_INSIDE_SPHERE",minRadius:n,maxRadius:i}},{toolName:"SphereEraser",parentTool:"Brush",configuration:{activeStrategy:"ERASE_INSIDE_SPHERE",minRadius:n,maxRadius:i}},{toolName:"ThresholdCircularBrush",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_CIRCLE",minRadius:n,maxRadius:i}},{toolName:"ThresholdSphereBrush",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_SPHERE",minRadius:n,maxRadius:i}},{toolName:"ThresholdCircularBrushDynamic",parentTool:"Brush",configuration:{activeStrategy:"THRESHOLD_INSIDE_CIRCLE",threshold:{isDynamic:!0,dynamicRadius:3},minRadius:n,maxRadius:i}}],enabled:[],disabled:[{toolName:e.Crosshairs,configuration:{disableOnPassive:!0,autoPan:{enabled:!1,panSize:10}}}]};t.createToolGroupAndAddTools(s,c),t.createToolGroupAndAddTools(l,{active:c.active,passive:[...c.passive,{toolName:"RectangleROIStartEndThreshold"}],enabled:c.enabled,disabled:c.disabled}),t.createToolGroupAndAddTools(r,c),t.createToolGroupAndAddTools(d,c);const m={active:[{toolName:e.VolumeRotate,bindings:[{mouseButton:o.MouseBindings.Wheel}],configuration:{rotateIncrementDegrees:5}},{toolName:e.MipJumpToClick,configuration:{toolGroupId:l},bindings:[{mouseButton:o.MouseBindings.Primary}]}],enabled:[{toolName:e.OrientationMarker,configuration:{orientationWidget:{viewportCorner:"BOTTOM_LEFT"}}}]};t.createToolGroupAndAddTools(u,m)}(e,o,t,a)};var m=t(40680);const p={commandName:"setToolActiveToolbar",commandOptions:{toolGroupIds:[s,l,r]}},h=[{id:"MeasurementTools",uiType:"ohif.toolButtonList",props:{buttonSection:!0}},{id:"SegmentationTools",uiType:"ohif.toolBoxButton",props:{buttonSection:!0}},{id:"BrushTools",uiType:"ohif.toolBoxButtonGroup",props:{buttonSection:!0}},{id:"AdvancedRenderingControls",uiType:"ohif.advancedRenderingControls",props:{buttonSection:!0}},{id:"modalityLoadBadge",uiType:"ohif.modalityLoadBadge",props:{icon:"Status",label:m.A.t("Buttons:Status"),tooltip:m.A.t("Buttons:Status"),evaluate:{name:"evaluate.modalityLoadBadge",hideWhenDisabled:!0}}},{id:"Colorbar",uiType:"ohif.colorbar",props:{type:"tool",label:m.A.t("Buttons:Colorbar")}},{id:"navigationComponent",uiType:"ohif.navigationComponent",props:{icon:"Navigation",label:m.A.t("Buttons:Navigation"),tooltip:m.A.t("Buttons:Navigate between segments/measurements and manage their visibility"),evaluate:{name:"evaluate.navigationComponent",hideWhenDisabled:!0}}},{id:"windowLevelMenuEmbedded",uiType:"ohif.windowLevelMenuEmbedded",props:{icon:"WindowLevel",label:m.A.t("Buttons:Window Level"),tooltip:m.A.t("Buttons:Adjust window/level presets and customize image contrast settings"),evaluate:{name:"evaluate.windowLevelMenuEmbedded",hideWhenDisabled:!0}}},{id:"trackingStatus",uiType:"ohif.trackingStatus",props:{icon:"TrackingStatus",label:m.A.t("Buttons:Tracking Status"),tooltip:m.A.t("Buttons:View and manage tracking status of measurements and annotations"),evaluate:{name:"evaluate.trackingStatus",hideWhenDisabled:!0}}},{id:"Length",uiType:"ohif.toolButton",props:{icon:"tool-length",label:m.A.t("Buttons:Length"),tooltip:m.A.t("Buttons:Length Tool"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"Bidirectional",uiType:"ohif.toolButton",props:{icon:"tool-bidirectional",label:m.A.t("Buttons:Bidirectional"),tooltip:m.A.t("Buttons:Bidirectional Tool"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"ArrowAnnotate",uiType:"ohif.toolButton",props:{icon:"tool-annotate",label:m.A.t("Buttons:Arrow Annotate"),tooltip:m.A.t("Buttons:Arrow Annotate Tool"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"EllipticalROI",uiType:"ohif.toolButton",props:{icon:"tool-ellipse",label:m.A.t("Buttons:Ellipse"),tooltip:m.A.t("Buttons:Ellipse Tool"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"Zoom",uiType:"ohif.toolButton",props:{icon:"tool-zoom",label:m.A.t("Buttons:Zoom"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"WindowLevel",uiType:"ohif.toolButton",props:{icon:"tool-window-level",label:m.A.t("Buttons:Window Level"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"Crosshairs",uiType:"ohif.toolButton",props:{icon:"tool-crosshair",label:m.A.t("Buttons:Crosshairs"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"Pan",uiType:"ohif.toolButton",props:{icon:"tool-move",label:m.A.t("Buttons:Pan"),commands:p,evaluate:"evaluate.cornerstoneTool"}},{id:"RectangleROIStartEndThreshold",uiType:"ohif.toolBoxButton",props:{icon:"tool-create-threshold",label:m.A.t("Buttons:Rectangle ROI Threshold"),commands:p,evaluate:["evaluate.cornerstone.segmentation",{name:"evaluate.cornerstoneTool",disabledText:m.A.t("Buttons:Select the PT Axial to enable this tool")}],options:"tmtv.RectangleROIThresholdOptions"}},{id:"Brush",uiType:"ohif.toolButton",props:{icon:"icon-tool-brush",label:m.A.t("Buttons:Brush"),evaluate:[{name:"evaluate.cornerstone.segmentation",toolNames:["CircularBrush","SphereBrush"],disabledText:m.A.t("Buttons:Create new segmentation to enable this tool.")},{name:"evaluate.cornerstone.segmentation.synchronizeDrawingRadius",radiusOptionId:"brush-radius"}],options:[{name:"Radius (mm)",id:"brush-radius",type:"range",explicitRunOnly:!0,min:n,max:i,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["CircularBrush","SphereBrush"]}}},{name:"Shape",type:"radio",id:"brush-mode",value:"CircularBrush",values:[{value:"CircularBrush",label:"Circle"},{value:"SphereBrush",label:"Sphere"}],commands:"setToolActiveToolbar"}]}},{id:"Eraser",uiType:"ohif.toolButton",props:{icon:"icon-tool-eraser",label:m.A.t("Buttons:Eraser"),evaluate:[{name:"evaluate.cornerstone.segmentation",toolNames:["CircularEraser","SphereEraser"]},{name:"evaluate.cornerstone.segmentation.synchronizeDrawingRadius",radiusOptionId:"eraser-radius"}],options:[{name:"Radius (mm)",id:"eraser-radius",type:"range",explicitRunOnly:!0,min:n,max:i,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["CircularEraser","SphereEraser"]}}},{name:"Shape",type:"radio",id:"eraser-mode",value:"CircularEraser",values:[{value:"CircularEraser",label:"Circle"},{value:"SphereEraser",label:"Sphere"}],commands:"setToolActiveToolbar"}]}},{id:"Threshold",uiType:"ohif.toolButton",props:{icon:"icon-tool-threshold",label:m.A.t("Buttons:Threshold Tool"),evaluate:[{name:"evaluate.cornerstone.segmentation",toolNames:["ThresholdCircularBrush","ThresholdSphereBrush"]},{name:"evaluate.cornerstone.segmentation.synchronizeDrawingRadius",radiusOptionId:"threshold-radius"}],options:[{name:"Radius (mm)",id:"threshold-radius",type:"range",explicitRunOnly:!0,min:n,max:i,step:.5,value:25,commands:{commandName:"setBrushSize",commandOptions:{toolNames:["ThresholdCircularBrush","ThresholdSphereBrush","ThresholdCircularBrushDynamic"]}}},{name:"Threshold",type:"radio",id:"dynamic-mode",value:"ThresholdRange",values:[{value:"ThresholdDynamic",label:"Dynamic"},{value:"ThresholdRange",label:"Range"}],commands:({value:e,commandsManager:o})=>{"ThresholdDynamic"===e?o.run("setToolActive",{toolName:"ThresholdCircularBrushDynamic"}):o.run("setToolActive",{toolName:"ThresholdCircularBrush"})}},{name:"Shape",type:"radio",id:"eraser-mode",value:"ThresholdCircularBrush",values:[{value:"ThresholdCircularBrush",label:"Circle"},{value:"ThresholdSphereBrush",label:"Sphere"}],condition:({options:e})=>"ThresholdRange"===e.find(e=>"dynamic-mode"===e.id).value,commands:"setToolActiveToolbar"},{name:"ThresholdRange",type:"double-range",id:"threshold-range",min:0,max:50,step:.5,value:[2.5,50],condition:({options:e})=>"ThresholdRange"===e.find(e=>"dynamic-mode"===e.id).value,commands:{commandName:"setThresholdRange",commandOptions:{toolNames:["ThresholdCircularBrush","ThresholdSphereBrush"]}}}]}},{id:"dataOverlayMenu",uiType:"ohif.dataOverlayMenu",props:{icon:"ViewportViews",label:m.A.t("Buttons:Data Overlay"),tooltip:m.A.t("Buttons:Configure data overlay options and manage foreground/background display sets"),evaluate:"evaluate.dataOverlayMenu"}},{id:"orientationMenu",uiType:"ohif.orientationMenu",props:{icon:"OrientationSwitch",label:m.A.t("Buttons:Orientation"),tooltip:m.A.t("Buttons:Change viewport orientation between axial, sagittal, coronal and reformat planes"),evaluate:{name:"evaluate.orientationMenu"}}},{id:"windowLevelMenu",uiType:"ohif.windowLevelMenu",props:{icon:"WindowLevel",label:m.A.t("Buttons:Window Level"),tooltip:m.A.t("Buttons:Adjust window/level presets and customize image contrast settings"),evaluate:"evaluate.windowLevelMenu"}},{id:"voiManualControlMenu",uiType:"ohif.voiManualControlMenu",props:{icon:"WindowLevelAdvanced",label:m.A.t("Buttons:Advanced Window Level"),tooltip:m.A.t("Buttons:Advanced window/level settings with manual controls and presets"),evaluate:"evaluate.voiManualControlMenu"}},{id:"thresholdMenu",uiType:"ohif.thresholdMenu",props:{icon:"Threshold",label:m.A.t("Buttons:Threshold"),tooltip:m.A.t("Buttons:Image threshold settings"),evaluate:{name:"evaluate.thresholdMenu",hideWhenDisabled:!0}}},{id:"opacityMenu",uiType:"ohif.opacityMenu",props:{icon:"Opacity",label:m.A.t("Buttons:Opacity"),tooltip:m.A.t("Buttons:Image opacity settings"),evaluate:{name:"evaluate.opacityMenu",hideWhenDisabled:!0}}}],v=JSON.parse('{"UU":"@ohif/mode-tmtv"}').UU;const{MetadataProvider:g}=a.Ly,T="@ohif/extension-default.layoutTemplateModule.viewerLayout",S="@ohif/extension-default.sopClassHandlerModule.stack",B="@ohif/extension-default.panelModule.seriesList",y="@ohif/extension-cornerstone.viewportModule.cornerstone",b="@ohif/extension-tmtv.hangingProtocolModule.ptCT",f="@ohif/extension-tmtv.panelModule.petSUV",A="@ohif/extension-tmtv.panelModule.tmtv",C={"@ohif/extension-default":"^3.0.0","@ohif/extension-cornerstone":"^3.0.0","@ohif/extension-cornerstone-dicom-seg":"^3.0.0","@ohif/extension-tmtv":"^3.0.0"},M=[];const w={id:v,modeFactory:function({modeConfiguration:e}){return{id:v,routeName:"tmtv",displayName:m.A.t("Modes:Total Metabolic Tumor Volume"),onModeEnter:({servicesManager:e,extensionManager:o,commandsManager:t})=>{const{toolbarService:a,toolGroupService:n,customizationService:i,hangingProtocolService:s,displaySetService:l}=e.services,u=o.getModuleEntry("@ohif/extension-cornerstone.utilityModule.tools"),{toolNames:d,Enums:m}=u.exports;c(d,m,n,t);const{unsubscribe:p}=n.subscribe(n.EVENTS.VIEWPORT_ADDED,()=>{const{displaySetMatchDetails:e}=s.getMatchDetails();!function(e,o,t,a){const n=e.get("ctDisplaySet");if(!n)return;const{SeriesInstanceUID:i}=n,s=a.getDisplaySetsForSeries(i),l={...t.getToolConfiguration(r,o.Crosshairs),filterActorUIDsToSetSlabThickness:[s[0].displaySetInstanceUID]};t.setToolConfiguration(r,o.Crosshairs,l)}(e,d,n,l),function(e,o,t,a){const n=e.get("ptDisplaySet"),i=e.get("ctDisplaySet");if(!n)return;const{SeriesInstanceUID:s}=n,l=a.getDisplaySetsForSeries(s);if(!l||0===l.length)return;const u=t.getToolConfiguration(r,o.WindowLevel),d=t.getToolConfiguration(r,o.EllipticalROI),c=`cornerstoneStreamingImageVolume:${l[0].displaySetInstanceUID}`,{SeriesInstanceUID:m}=i,p={...u,volumeId:`cornerstoneStreamingImageVolume:${a.getDisplaySetsForSeries(m)[0].displaySetInstanceUID}`},h={...d,volumeId:c};t.setToolConfiguration(r,o.WindowLevel,p),t.setToolConfiguration(r,o.EllipticalROI,h)}(e,d,n,l)});M.push(p),a.register(h),a.updateSection(a.sections.primary,["MeasurementTools","Zoom","Pan","WindowLevel","Crosshairs"]),a.updateSection(a.sections.viewportActionMenu.topLeft,["orientationMenu","dataOverlayMenu"]),a.updateSection(a.sections.viewportActionMenu.bottomMiddle,["AdvancedRenderingControls"]),a.updateSection("AdvancedRenderingControls",["windowLevelMenuEmbedded","voiManualControlMenu","Colorbar","opacityMenu","thresholdMenu"]),a.updateSection(a.sections.viewportActionMenu.topRight,["modalityLoadBadge","trackingStatus","navigationComponent"]),a.updateSection(a.sections.viewportActionMenu.bottomLeft,["windowLevelMenu"]),a.updateSection("MeasurementTools",["Length","Bidirectional","ArrowAnnotate","EllipticalROI"]),a.updateSection("ROIThresholdToolbox",["SegmentationTools"]),a.updateSection("SegmentationTools",["RectangleROIStartEndThreshold","BrushTools"]),a.updateSection("BrushTools",["Brush","Eraser","Threshold"]),i.setCustomizations({"panelSegmentation.tableMode":{$set:"expanded"},"panelSegmentation.onSegmentationAdd":{$set:()=>{t.run("createNewLabelmapFromPT")}}}),s.addCustomAttribute("getPTVOIRange","get PT VOI based on corrected or not",e=>{const o=e.find(e=>"PT"===e.Modality);if(!o)return;const{imageId:t}=o.images[0],a=g.get("scalingModule",t);return a&&a.suvbw?{windowWidth:5,windowCenter:2.5}:void 0})},onModeExit:({servicesManager:e})=>{const{toolGroupService:o,syncGroupService:t,segmentationService:a,cornerstoneViewportService:n,uiDialogService:i,uiModalService:s}=e.services;M.forEach(e=>e()),i.hideAll(),s.hide(),o.destroy(),t.destroy(),a.destroy(),n.destroy()},validationTags:{study:[],series:[]},isValidMode:({modalities:e,study:o})=>{const t=e.split("\\");return{valid:t.includes("CT")&&"M1"!==o.mrn&&t.includes("PT")&&!["SM"].some(e=>t.includes(e))&&"1.3.6.1.4.1.12842.1.1.14.3.20220915.105557.468.2963630849"!==o.studyInstanceUid,description:"The mode requires both PT and CT series in the study"}},routes:[{path:"tmtv",layoutTemplate:()=>({id:T,props:{leftPanels:[B],leftPanelResizable:!0,leftPanelClosed:!0,rightPanels:[A,f],rightPanelResizable:!0,viewports:[{namespace:y,displaySetsToDisplay:[S]}]}})}],extensions:C,hangingProtocol:b,sopClassHandlers:[S],...e}},extensionDependencies:C}}}]);
//# sourceMappingURL=9927.bundle.7f1c0bd90d10352e03fe.js.map